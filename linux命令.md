# 服务器性能监控

## 测试目的

发现服务器的性能瓶颈，配置的不同能够承载的最大任务数不同，能够承载的压力也不同

## 测试范围和性能指标

+ CPU
+ 内存
+ 磁盘
+ 网络
+ 版本

## 进程与线程

进程：能独立运行的，可以拥有多个线程，会分配一个地址空间，进程之间不共享内存地址空间，一个进程下的多个线程可以共享父进程的地址空间

线程：是进程的一个实体，在进程中运行，是进程工作的最小单位，一个线程只能属于一个进程

## Linux命令

man：可以查看所有命令的使用方法

top：实时监控系统运行状态

​         参数：-h：帮助

​                     -p：监控指定的进程，多个进程时用逗号隔开

​                     M：按内存使用率排序

​                     P：按cpu使用率排序

​                      z：彩色/黑白显示

 top中load average：系统的运行队列的平均利用率，也可认为是可运行进程的平均数。三个值分别表示在最后的1分钟、5分钟、15分钟的平均负载值。在单核CPU中 load average值为1时，表示满负荷状态，多核CPU中满负载的loadaverage的值为1*cpu核数

vmstat：可以监控操作系统的进程状态、内存、虚拟内存、磁盘IO、cpu的信息

​               参数：-S：使用指定单位显示，k、K、m、M，分别代表1000、1024、1000000、1048576，默认单位为K

free：监控内存使用状态

mpstat：监控cpu，可以查看多核cpu中每个计算核心的统计数据

​                -P : 监控哪个cpu

​                internal：相邻的两次采样的间隔时间

​                count：采样的次数，只能和delay一起使用

netstat：用于显示网络连接、运行端口、路由表信息

​              参数：-n：拒绝显示别名，能显示数字的全部转换为数字

​                          -l：仅列出有在listen的服务状态

​                           -p：显示简历相关链接的程序名

​                           -t：显示tcp相关选项

​                          -u：显示udp相关选项

​                           -i：显示自动匹配接口的信息

​                          -c：每隔一个固定时间，执行该netstat命令

iostat：用于监控磁盘

​            参数：-x

sar：Linux上全面的系统性能分析工具之一，监控文件读写、系统调用、cpu、内存、IO等的

​       参数：-A：所以报告的总和

​                  -u：cpu利用率

​                  -v：进程文件

​                 -r：系统内存

​                 -B：内存分页

​                -b：缓冲区使用情况

strace：进程追踪的命令

​            参数：-p：跟踪指定进程

​                       -f：跟踪由fork子进程系统调用

​                       -c：统计每次调用所执行的时间次数和出错的次数等

​                       -t：在输出的每一行前加上时间信息，-tt时间确定到微妙级

​                       -e：输出过滤器

​                       -o：导入到文件

## Linux监控工具

nmon：下载与安装

​            参数：-f：输出文件，必选参数且放在第一位，默认名称就是hostname_date_tie.nmon

​                       -F：和-f相同，只不过用户可以自定义文件名称

​                       -s：采集数据的频率

​                       -c：采集数据次数

​                       -t：输出最消耗资源的进程数据

​                       -h：查看帮助

## Linux定时任务

crontab：service crond status

​                  start / stop retart 

​                  reload 重新载入配置

​                 权限：cron.allow：存储的是允许哪些用户使用crontab

​                             cron.deny：存储的是不允许哪些用户使用crontab

​                            如果没有这两个文件，可以在etc目录下创建

​                corntab -e基本格式：分 时 日 月 周 命令

​                                                   时间单位说明：第一列表示分钟00~59，每分钟用*或 */

​                                                  *:表示所有

​                                                  /:表示每

​                                                 -：表示范围

​                                                ，：表示多个

​                  



​                  